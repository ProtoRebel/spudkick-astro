---
import BaseLayout from '../../layouts/BaseLayout.astro';
import VideoBacking from '../../components/VideoBacking.astro';

const title = 'Portfolio';
const description = 'Explore our Boise-based website/software portfolio; showcasing sleek, custom white-labeled solutions for clients across the U.S. that deliver real results.';
const permalink = `${Astro.site.href}portfolio`;

const portfolioFiles = await import.meta.glob('../../../data/portfolio/*.md', { eager: true });

// Convert to array and sort
const allPortfolio = Object.entries(portfolioFiles)
  .map(([path, post]) => ({
    ...post,
    path
  }))
  .sort((a, b) =>
    new Date(b.frontmatter.launchDate).valueOf() -
        new Date(a.frontmatter.launchDate).valueOf()
  );
---

<BaseLayout title={title} description={description} permalink={permalink} current="portfolio">
  <section>
    <h1>Portfolio Entries from ProtoRebel, LLC</h1>
    <p>
      <span class="click">Click</span><span class="tap">Tap</span> on a project below to learn about it
    </p>
    <ul>
      {allPortfolio.map((portfolio) => {
        const href = `/portfolio/${portfolio.file.split('/').pop().split('.').shift()}`;
        return (
          <li>
            <a href={href}>
              <div class="data">
                <h2>{portfolio.frontmatter.client}</h2>
                <p>{portfolio.frontmatter.searchTerm}</p>
                <span>&rarr;</span>
              </div>
              <div class="visual">
                <div class="video">
                  <VideoBacking />
                </div>
                <img src={portfolio.frontmatter.imgPath + portfolio.frontmatter.emblem} width="192" height="192" alt=`Emblem for the business ${portfolio.frontmatter.client}` class="emblem" />
                <img src={portfolio.frontmatter.imgPath + portfolio.frontmatter.photoFeatured} width="1600" height="450" alt=`Screenshot from a ${portfolio.frontmatter.scope} project for the business ${portfolio.frontmatter.client}` class="screenshot" />
              </div>
            </a>
          </li>
        );
      })}
    </ul>
  </section>
</BaseLayout>

<style>

section {
    padding: 0 var(--pad-small);
    background-color: var(--color-black);
}

@media (min-width: 960px) {
    section {
        padding-left: 0;
        padding-top: 0;
    }
}

h1 {
    display: none;
}

ul {
    margin: 0;
    padding: 0;
    list-style-type: none;
}

li {
    margin: var(--pad-small) 0;
}

li:last-child {
    margin-bottom: 0;
}

a {
    display: flex;
    flex-direction: column-reverse;
    color: var(--color-yellow);
    transition: var(--transition-hover);
}

.visual {
    position: relative;
    overflow: hidden;
    height: 10rem;
}

.visual::after {
    content: '';
    display: block;
    width: calc(100% - 10rem);
    height: 100%;
    background: linear-gradient(to right, var(--color-black) 0%, var(--color-black--trans) 25%, transparent 100%);
    position: absolute;
    top: 0;
    left: 10rem;
    z-index: 10;
}

.video {
    position: absolute;
    width: 100%;
    height: 100%;
    transform: scaleX(-1);
    z-index: 0;
}

.emblem {
    position: absolute;
    height: 10rem;
    width: 10rem;
    display: block;
    top: 0;
    left: 0;
    mix-blend-mode: multiply;
    object-fit: cover;
    z-index: 9;
}

.screenshot {
    display: block;
    position: absolute;
    width: calc(100% - 10rem);
    height: 100%;
    top: 0;
    left: 10rem;
    object-fit: cover;
    z-index: 1;
    filter: grayscale(1);
    mix-blend-mode: hard-light;
    transition: var(--transition-hover);
    opacity: 0.5;
}

@media(min-width: 960px) {
    .visual {
        height: 20rem;
    }

    .visual::after {
        width: calc(100% - 1820);
        left: 20rem;
    }

    .emblem {
        height: 20rem;
        width: 20rem;
    }

    .screenshot {
        width: calc(100% - 20rem);
        left: 20rem;
    }

}

p {
    padding: 0;
}

section > p {
    margin: var(--pad-small) 0;
}

.data {
    display: flex;
    align-items: center;
    margin-top: 0.5rem;
}

.data h2,
.data p {
    line-height: 1;
    margin: 0;
    padding: 0;
    color: var(--color-yellow);
}

.data h2 {
    font-size: 1.25rem;
}

.data h2::after {
    content: "â€¢";
    margin: 0 1ex;
    color: var(--color-white);
}

.data p {
    font-size: 0.85em;
    margin-right: 1ex;
}

.data span {
    display: block;
    font-size: 1.25em;
    animation: saw 1s infinite alternate ease-out;
    color: var(--color-black);
    transition: var(--transition-hover);
}

a:hover h2,
a:active h2,
a:focus h2,
a:hover p,
a:active p,
a:focus p {
    color: var(--color-white);
}

a:hover .screenshot,
a:active .screenshot,
a:focus .screenshot {
    opacity: 1;
}

a:hover .data span,
a:active .data span,
a:focus .data span {
    color: var(--color-yellow);
}

p .click {
    display: none;
}

@media (min-width: 960px) {
    p .click {
        display: inline;
    }

    p .tap {
        display: none;
    }
}

</style>
