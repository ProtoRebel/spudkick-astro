---
import VideoBacking from '../components/VideoBacking.astro';
import { Image } from 'astro:assets';
---

<section>
  <VideoBacking />
  <div class="slideshow">
    <div class="slides">
      <div class="slide slide-1">
        <span>Part 1</span>
        <h2>You have an idea</h2>
      </div>
      <div class="slide slide-2">
        <span>Part 2</span>
        <h2>Your Idea is challenging</h2>
      </div>
      <div class="slide slide-3">
        <span>Part 3</span>
        <h2>You need a pro to make your idea real</h2>
      </div>
    </div>
    <div class="slide slide-4">
      <Image alt="Logo for ProtoRebel" width="226" height="40" src="/assets/images/pr-logo-white.svg" />
      <p>Turn your idea into reality.</p>
    </div>
  </div>
  <script is:inline>
        if (typeof cleanup === 'undefined') {
          var cleanup;
        }

        function initializeSlideshow() {
          const slideshowContainer = document.querySelector('.slideshow');

          if (!slideshowContainer) {
            return;
          }

          let currentSlide = 0;
          const slides = slideshowContainer.querySelectorAll('.slide');
          const totalSlides = slides.length;
          const transitionDuration = 666;

          function resetSlides() {
            slides.forEach((slide) => {
              slide.classList.remove('push-up', 'move-up', 'push-right', 'move-left', 'fade-in', 'fade-out');
              slide.style.zIndex = '10';
              slide.style.visibility = 'hidden';
              slide.style.opacity = '0';
            });
          }

          function hideCurrentSlide() {
            const current = slides[currentSlide];
            if (currentSlide === 0) {
              current.classList.add('push-up');
            } else if (currentSlide === 1) {
              current.classList.add('push-right');
            } else {
              current.classList.add('fade-out');
            }
            current.style.opacity = '0';
          }

          function showNextSlide() {
            hideCurrentSlide();

            setTimeout(() => {
              const nextIndex = (currentSlide + 1) % totalSlides;
              const next = slides[nextIndex];

              resetSlides();

              next.style.visibility = 'visible';
              next.style.zIndex = '30';

              if (nextIndex === 1) {
                next.classList.add('move-up');
              } else if (nextIndex === 2) {
                next.classList.add('move-left');
              } else {
                next.classList.add('fade-in');
              }

              setTimeout(() => {
                next.style.opacity = '1';
              }, 10);

              currentSlide = nextIndex;
            }, transitionDuration);
          }

          resetSlides();
          slides[currentSlide].style.visibility = 'visible';
          slides[currentSlide].style.opacity = '1';
          slides[currentSlide].style.zIndex = '30';

          const intervalId = setInterval(showNextSlide, 5200);

          return () => clearInterval(intervalId);
        }

        function setupSlideshow() {
          if (cleanup) {
            cleanup();
          }
          cleanup = initializeSlideshow();
        }

        // Run on initial load
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', setupSlideshow);
        } else {
          setupSlideshow();
        }

        // Run on subsequent navigations (if View Transitions are re-enabled)
        document.addEventListener('astro:page-load', setupSlideshow);
  </script>
</section>

<style>
    section {
        position: relative;
        width: 100%;
        overflow: hidden;
    }

    .slideshow {
        position: relative;
        width: 100%;
        height: auto;
        aspect-ratio: 1/1;
        overflow: hidden;
    }

    h2 {
        color: var(--color-white);
    }

    @media (min-width: 960px) {
        .slideshow {
            aspect-ratio: 16/9;
        }
    }

    .slides {
        position: relative;
        width: 100%;
        height: 100%;
    }

    .slide {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        visibility: hidden;
        transition: transform 666ms ease, opacity 666ms ease;
        display: block;
        mix-blend-mode: hard-light;
        color: var(--color-white);
        padding: var(--pad-small);
        font-size: 1.5em;
        background-size: cover;
    }

    @media (min-width: 960px) {
        .slide {
            padding-left: 0;
            padding-right: 0;
        }
    }

    .slide span {
        font-family: var(--font-family--serif);
        text-transform: lowercase;
        color: var(--color-grey--light);
    }

    .slide h2 {
        font-family: var(--font-family--default);
        font-style: normal;
        font-size: 1.5em;
    }

    .slide-1 {
        opacity: 1;
        visibility: visible;
        z-index: 30;
        background-image: url('/assets/images/pr-vp-idea.webp');
        background-position: center bottom;
    }

    @media (min-width: 960px) {
        .slide-1 {
            background-position: center center;
        }
    }

    .slide-1.push-up {
        transform: translateY(-100%);
        opacity: 0;
        visibility: hidden;
        z-index: 10;
    }

    .slide-2 {
        transform: translateY(100%);
        z-index: 20;
        background-image: url('/assets/images/pr-vp-sisyphus.webp');
        background-position: right bottom;
    }

    .slide-2.move-up {
        transform: translateY(0);
        opacity: 1;
        visibility: visible;
    }

    .slide-2.push-right {
        transform: translateX(100%);
        opacity: 0;
        visibility: hidden;
        z-index: 10;
    }

    .slide-3 {
        transform: translateX(-100%);
        z-index: 20;
        background-image: url('/assets/images/pr-vp-map.webp');
        background-position: center bottom;
    }

    .slide-3.move-left {
        transform: translateX(0);
        opacity: 1;
        visibility: visible;
    }

    .slide-4 {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        opacity: 0;
        visibility: hidden;
        z-index: 10;
        background-image: url('/assets/images/pr-mask-mark.svg');
        background-position: center top;
    }

    .slide-4 img {
        display: block;
        width: 80%;
        max-width: 480px;
        font-size: 2em;
    }
    
    @media (max-width: 960px) {
        .slide-4 {
            background-position: center center;
        }
    }

    .slide-4 p {
        font-family: var(--font-family--serif);
        font-size: var(--font-size--large);
        text-transform: lowercase;
        text-align: center;
    }

    .slide-4.fade-in {
        opacity: 1;
        visibility: visible;
        z-index: 30;
    }

    .slide.fade-out {
        opacity: 0;
        visibility: hidden;
        z-index: 10;
    }
</style>